From 66a77a37e5d019a359ec12262ce0efa645980ba3 Mon Sep 17 00:00:00 2001
From: Francois Berder <francois.berder@imgtec.com>
Date: Fri, 3 Feb 2017 10:10:08 +0000
Subject: [PATCH 72/87] ASoC: img: parallel-out: Add start_at_abort handler

Signed-off-by: Francois Berder <francois.berder@imgtec.com>
Signed-off-by: Damien.Horsley <Damien.Horsley@imgtec.com>
---
 sound/soc/img/img-parallel-out.c | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/sound/soc/img/img-parallel-out.c b/sound/soc/img/img-parallel-out.c
index c1610a0..ec0015a 100644
--- a/sound/soc/img/img-parallel-out.c
+++ b/sound/soc/img/img-parallel-out.c
@@ -173,10 +173,21 @@ static int img_prl_out_set_fmt(struct snd_soc_dai *dai, unsigned int fmt)
 	return 0;
 }
 
+static int img_prl_out_start_at_abort(struct snd_pcm_substream *substream,
+		struct snd_soc_dai *cpu_dai)
+{
+	struct img_prl_out *prl = snd_soc_dai_get_drvdata(cpu_dai);
+
+	img_prl_out_reset(prl);
+
+	return 0;
+}
+
 static const struct snd_soc_dai_ops img_prl_out_dai_ops = {
 	.trigger = img_prl_out_trigger,
 	.hw_params = img_prl_out_hw_params,
-	.set_fmt = img_prl_out_set_fmt
+	.set_fmt = img_prl_out_set_fmt,
+	.start_at_abort = img_prl_out_start_at_abort
 };
 
 static int img_prl_out_dai_probe(struct snd_soc_dai *dai)
-- 
2.7.4

